# üöÄ Ansible Deploy Project for ARSP

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ARSP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Astra Linux

## üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/holyblaz/ansible_deploy.git
cd ansible_deploy/ansible

üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ù–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –Ω–æ–¥–µ

    –û–°: Ubuntu/Debian

    Ansible: –≤–µ—Ä—Å–∏—è ‚â• 2.12

    SSH-–∫–ª–∏–µ–Ω—Ç

    Python: –≤–µ—Ä—Å–∏—è ‚â• 3.5

–ù–∞ —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –Ω–æ–¥–∞—Ö

    Python: –≤–µ—Ä—Å–∏—è ‚â• 3.5

    SSH-–¥–æ—Å—Ç—É–ø –∫ —Ü–µ–ª–µ–≤—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º

    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: sysadm (–ø–∞—Ä–æ–ª—å —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ /vars/main.yml)

    SSH-–∫–ª—é—á–∏ –∏–ª–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞

üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
ansible_deploy/
‚îú‚îÄ‚îÄ deploy.yml                        # üöÄ –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–µ–π–±—É–∫
‚îú‚îÄ‚îÄ files/                            # üìÅ –§–∞–π–ª—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ arsp_new_XX_XX_XX.zip         # üì¶ –ê—Ä—Ö–∏–≤ —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ add_migrations.py             # üêç –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ pg_backup.sh                  # üíæ –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ç–∫–∞–ø–∞ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ project_copy.sh               # üìÑ –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ python_scripts/               # üìú –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ redeploy_no_db_no_compile.sh  # ‚ö° –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–µ–∑ –ë–î –∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ write_showmigrations_info.py  # üîç –°–∫—Ä–∏–ø—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ inventory/
‚îÇ   ‚îî‚îÄ‚îÄ hosts.yml                     # üåê –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —Ö–æ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ telegram.j2                   # ‚úâÔ∏è –®–∞–±–ª–æ–Ω –¥–ª—è Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îî‚îÄ‚îÄ vars/
    ‚îî‚îÄ‚îÄ main.yml                      # ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ inventory/hosts.yml:
```yaml
all:
  children:
    test_servers:        # üñ•Ô∏è –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã
      hosts:
        server1:
          ansible_host: 172.29.12.225
        server2:
          ansible_host: 172.29.12.231
        server3:
          ansible_host: 172.29.12.229
    
    hosts_for_developers: # üíª –°–µ—Ä–≤–µ—Ä—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
      hosts:
        server4:
          ansible_host: 172.29.12.XX1
        server5:
          ansible_host: 172.29.12.XX2

üéØ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã
–ö–æ–º–∞–Ω–¥–∞	–û–ø–∏—Å–∞–Ω–∏–µ	–ü—Ä–∏–º–µ—Ä
ansible-playbook -i hosts.yml deploy.yml --limit "test_servers"	–î–µ–ø–ª–æ–π –Ω–∞ —Ä–∞–±–æ—á–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö	--limit "test_servers"
ansible-playbook -i hosts.yml deploy.yml --limit "hosts_for_developers"	–î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤	--limit "server4"
ansible all -i hosts.yml -m ping	–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –Ω–æ–¥	

### X. –ó–∞–ø—É—Å–∫ playbook

 # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –Ω–æ–¥
    ansible all -i inventory.yml -m ping

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
    ansible-playbook -i inventory/hosts.yml deploy.yml # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤, —É–∫–∞–∑–∞–Ω—ã—ã–∑ –≤ host.yml -> –≤ –≥—Ä—É–ø–ø–µ all

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ö–æ—Å—Ç–∞—Ö:
    ansible-playbook -i inventory/hosts.yml deploy.yml --limit "server1,server2.." # –ó–∞–ø—É—Å–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤, —É–∫–∞–∑–∞–Ω—ã—ã—Ö –≤ host.yml -> –≤ –≥—Ä—É–ø–ø–µ all 



***–ó–∞–ø—É—Å–∫ Ansible –Ω–∞ Windows***

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WSL2:
    wsl --install -d Ubuntu

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Ubuntu –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç—ã:
    sudo apt update && sudo apt upgrade -y

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ansible:
    sudo apt install ansible -y

4. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å Ansible —á–µ—Ä–µ–∑ WSL


***Docker (Ansible –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)*** –¢–ï–°–¢–û–í–´–ô –í–ê–†–ò–ê–ù–¢

- docker run --rm -v ${PWD}:/ansible ansible/ansible:latest ansible playbook playbook.yml


